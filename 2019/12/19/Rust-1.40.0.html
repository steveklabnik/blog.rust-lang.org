<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Announcing Rust 1.40.0 | Rust Blog</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
<meta name="description" content="Empowering everyone to build reliable and efficient software.">
     <!-- Twitter card -->
 <meta name="twitter:card" content="summary">
 <meta name="twitter:site" content="@rustlang">
 <meta name="twitter:creator" content="@rustlang">
 <meta name="twitter:title" content="Announcing Rust 1.40.0 | Rust Blog">
 <meta name="twitter:description" content="Empowering everyone to build reliable and efficient software.">
<meta name="twitter:image" content="https://www.rust-lang.org/static/images/rust-social.jpg">

<!-- Facebook OpenGraph -->
<meta property="og:title" content="Announcing Rust 1.40.0 | Rust Blog" />
<meta property="og:description" content="Empowering everyone to build reliable and efficient software.">
<meta property="og:image" content="https://www.rust-lang.org/static/images/rust-social-wide.jpg" />
<meta property="og:type" content="website" />
<meta property="og:locale" content="en_US" />

<!-- styles -->
<link rel="stylesheet" href="/styles/vendor.css"/>
<link rel="stylesheet" href="/styles/fonts.css"/>
<link rel="stylesheet" href="/styles/app.css"/>
<link rel="stylesheet" href="/styles/highlight.css"/>

<!-- favicon -->
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
<link rel="icon" type="image/svg+xml" href="/images/favicon.svg">
<link rel="manifest" href="/images/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#00aba9">
<meta name="theme-color" content="#ffffff">

 <!-- atom -->
 <link type="application/atom+xml" rel="alternate" href="https://blog.rust-lang.org/feed.xml" title="Rust Blog" />

  </head>
  <body>
    <nav class="flex flex-row justify-center justify-end-l items-center flex-wrap ph2 pl3-ns pr4-ns">
  <div class="brand flex-auto w-100 w-auto-l self-start tc tl-l">
    <a href="/">
      <img class="v-mid ml0-l" alt="Rust Logo" src="/images/rust-logo-blk.svg">
      <span class="dib ml1 ml0-l">Rust Blog</span>
    </a>
  </div>

  <ul class="nav list w-100 w-auto-l flex flex-none flex-row flex-wrap justify-center justify-end-l items-center pv2 ph0 ph4-ns">
    <li class="tc pv2 ph2 ph4-ns flex-20-s"><a href="https://www.rust-lang.org">Rust</a></li>
    <li class="tc pv2 ph2 ph4-ns flex-20-s"><a href="https://www.rust-lang.org/tools/install">Install</a></li>
    <li class="tc pv2 ph2 ph4-ns flex-20-s"><a href="https://www.rust-lang.org/learn">Learn</a></li>
    <li class="tc pv2 ph2 ph4-ns flex-20-s"><a href="https://www.rust-lang.org/tools">Tools</a></li>
    <li class="tc pv2 ph2 ph4-ns flex-20-s"><a href="https://www.rust-lang.org/governance">Governance</a></li>
    <li class="tc pv2 ph2 ph4-ns flex-20-s"><a href="https://www.rust-lang.org/community">Community</a></li>
  </ul>
</nav>

<section id="Announcing Rust 1.40.0" class="white">
  <div class="w-100 mw-none ph3 mw8-m mw8-l center f3">
    <header>
      <h2>Announcing Rust 1.40.0</h2>
      <div class="highlight mt2 mb3"></div>
    </header>

    <div class="publish-date-author">Dec. 19, 2019 &middot; The Rust Release Team
    
    </div>

    <div class="post">
      <p>The Rust team is happy to announce a new version of Rust, 1.40.0. Rust is a programming language that is empowering everyone to build reliable and efficient software.</p>
<p>If you have a previous version of Rust installed via rustup, getting Rust 1.40.0 is as easy as:</p>
<pre><code class="language-console">rustup update stable
</code></pre>
<p>If you don't have it already, you can <a href="https://www.rust-lang.org/install.html">get <code>rustup</code></a> from the appropriate page on our website, and check out the <a href="https://github.com/rust-lang/rust/blob/master/RELEASES.md#version-1400-2019-12-19">detailed release notes for 1.40.0</a> on GitHub.</p>
<h2><a href="#whats-in-1400-stable" aria-hidden="true" class="anchor" id="whats-in-1400-stable"></a>What's in 1.40.0 stable</h2>
<p>The highlights of Rust 1.40.0 include <code>#[non_exhaustive]</code> and improvements to <code>macros!()</code> and <code>#[attribute]</code>s. Finally, borrow-check migration warnings have become hard errors in Rust 2015. See the <a href="https://github.com/rust-lang/rust/blob/master/RELEASES.md#version-1400-2019-12-19">detailed release notes</a> for additional information.</p>
<h3><a href="#non_exhaustive-structs-enums-and-variants" aria-hidden="true" class="anchor" id="non_exhaustive-structs-enums-and-variants"></a><code>#[non_exhaustive]</code> structs, enums, and variants</h3>
<p>Suppose you're a library author of a crate <code>alpha</code>, that has a <code>pub struct Foo</code>. You would like to make <code>alpha::Foo</code>'s fields <code>pub</code> as well, but you're not sure whether you might be adding more fields to <code>Foo</code> in future releases. So now you have a dilemma: either you make the fields private, with the drawbacks that follow, or you risk users depending on the exact fields, breaking their code when you add a new one. Rust 1.40.0 introduces a way to break the logjam: <code>#[non_exhaustive]</code>.</p>
<p>The attribute <code>#[non_exhaustive]</code>, when attached to a <code>struct</code> or the variant of an <code>enum</code>, will prevent code outside of the crate defining it from constructing said <code>struct</code> or variant. To avoid future breakage, other crates are also prevented from exhaustively matching on the fields. The following example illustrates errors in <code>beta</code> which depends on <code>alpha</code>:</p>
<pre><code class="language-rust">// alpha/lib.rs:

#[non_exhaustive]
struct Foo {
    pub a: bool,
}

enum Bar {
    #[non_exhaustive]
    Variant { b: u8 }
}

fn make_foo() -&gt; Foo { ... }
fn make_bar() -&gt; Bar { ... }

// beta/lib.rs:

let x = Foo { a: true }; //~ ERROR
let Foo { a } = make_foo(); //~ ERROR

// `beta` will still compile when more fields are added.
let Foo { a, .. } = make_foo(); //~ OK


let x = Bar::Variant { b: 42 }; //~ ERROR
let Bar::Variant { b } = make_bar(); //~ ERROR
let Bar::Variant { b, .. } = make_bar(); //~ OK
                   // -- `beta` will still compile...
</code></pre>
<p>What happens behind the scenes is that the visibility of the constructors for a <code>#[non_exhaustive]</code> <code>struct</code> or <code>enum</code> variant is lowered to <code>pub(crate)</code>, preventing access outside the crate defining it.</p>
<p>A perhaps more important aspect of <code>#[non_exhaustive]</code> is that it can also be attached to <code>enum</code>s themselves. An example, taken from the standard library, is <a href="https://doc.rust-lang.org/std/sync/atomic/enum.Ordering.html"><code>Ordering</code></a>:</p>
<pre><code class="language-rust">#[non_exhaustive]
pub enum Ordering { Relaxed, Release, Acquire, AcqRel, SeqCst }
</code></pre>
<p>The purpose of <code>#[non_exhaustive]</code> in this context is to ensure that more variants can be added over time. This is achieved by preventing other crates from exhaustively pattern <code>match</code>-ing on <code>Ordering</code>. That is, the compiler would reject:</p>
<pre><code class="language-rust">match ordering {
    // This is an error, since if a new variant is added,
    // this would suddenly break on an upgrade of the compiler.
    Relaxed | Release | Acquire | AcqRel | SeqCst =&gt; {
        /* logic */
    }
}
</code></pre>
<p>Instead, other crates need to account for the possibility of more variants by adding a wildcard arm using e.g. <code>_</code>:</p>
<pre><code class="language-rust">match ordering {
    Relaxed | Release | Acquire | AcqRel | SeqCst =&gt; { /* ... */ }
    // OK; if more variants are added, nothing will break.
    _ =&gt; { /* logic */ }
}
</code></pre>
<p>For more details on the <code>#[non_exhaustive]</code> attribute, see the <a href="https://github.com/rust-lang/rust/issues/44109#issuecomment-533356866">stabilization report</a>.</p>
<h3><a href="#macro-and-attribute-improvements" aria-hidden="true" class="anchor" id="macro-and-attribute-improvements"></a>Macro and attribute improvements</h3>
<p>In 1.40.0, we have introduced several improvements to macros and attributes, including:</p>
<ul>
<li>
<p><a href="https://github.com/rust-lang/rust/pull/63931/#issuecomment-526362396">Calling procedural macros <code>mac!()</code> in type contexts.</a></p>
<p>For example, you may write <code>type Foo = expand_to_type!(bar);</code> where <code>expand_to_type</code> would be a procedural macro.</p>
</li>
<li>
<p><a href="https://github.com/rust-lang/rust/pull/63931/#issuecomment-526362396">Macros in <code>extern { ... }</code> blocks.</a></p>
<p>This includes <code>bang!()</code> macros, for example:</p>
<pre><code class="language-rust">macro_rules! make_item { ($name:ident) =&gt; { fn $name(); } }

extern {
    make_item!(alpha);
    make_item!(beta);
}
</code></pre>
<p>Procedural macro attributes on items in <a href="https://doc.rust-lang.org/nightly/reference/items/external-blocks.html"><code>extern { ... }</code> blocks</a> are now also supported:</p>
<pre><code class="language-rust">extern &quot;C&quot; {
    // Let's assume that this expands to `fn foo();`.
    #[my_identity_macro]
    fn foo();
}
</code></pre>
</li>
<li>
<p><a href="https://github.com/rust-lang/rust/pull/64035#issuecomment-533890826">Generating <code>macro_rules!</code> items in procedural macros.</a></p>
<p>Function-like (<code>mac!()</code>) and attribute (<code>#[mac]</code>) macros can both now generate <code>macro_rules!</code> items. For details on hygiene, please refer to the attached stabilization report.</p>
</li>
<li>
<p><a href="https://github.com/rust-lang/rust/pull/63674">The <code>$m:meta</code> matcher</a> supports <a href="https://github.com/rust-lang/rust/pull/57367#issuecomment-457882109">arbitrary token-stream values</a>.</p>
<p>That is, the following is now valid:</p>
<pre><code class="language-rust">macro_rules! accept_meta { ($m:meta) =&gt; {} }
accept_meta!( my::path );
accept_meta!( my::path = &quot;lit&quot; );
accept_meta!( my::path ( a b c ) );
accept_meta!( my::path [ a b c ] );
accept_meta!( my::path { a b c } );
</code></pre>
</li>
</ul>
<h3><a href="#borrow-check-migration-warnings-are-hard-errors-in-rust-2015" aria-hidden="true" class="anchor" id="borrow-check-migration-warnings-are-hard-errors-in-rust-2015"></a>Borrow check migration warnings are hard errors in Rust 2015</h3>
<p>In the 1.35.0 release, <a href="https://blog.rust-lang.org/2019/07/04/Rust-1.36.0.html#nll-for-rust-2015">we announced</a> that NLL had come to Rust 2015 after first being released for the 2018 edition in <a href="https://blog.rust-lang.org/2018/12/06/Rust-1.31-and-rust-2018.html#non-lexical-lifetimes">Rust 1.31</a>.</p>
<p>As we noted back then, the old borrow checker had some bugs which would allow memory unsafety, and the NLL borrow checker fixed them. As these fixes break some stable code, we decided to gradually phase in the errors, by checking if the old borrow checker would accept the program and the NLL checker would reject it. In those cases, the errors would be downgraded to warnings.</p>
<p>The previous release, Rust 1.39.0, changes these warnings into errors for code using the <a href="https://github.com/rust-lang/rust/pull/63565">2018 edition</a>. Rust 1.40.0 applies the same change for users of the <a href="https://github.com/rust-lang/rust/pull/64221">2015 edition</a>, closing those soundness holes for good. This also allows us to <a href="https://github.com/rust-lang/rust/pull/64790">clean up the old code from the compiler</a>.</p>
<p>If your build breaks due to this change, or you want to learn more, check out <a href="https://blog.rust-lang.org/2019/11/01/nll-hard-errors.html">Niko Matsakis's blog post</a>.</p>
<h3><a href="#more-const-fns-in-the-standard-library" aria-hidden="true" class="anchor" id="more-const-fns-in-the-standard-library"></a>More <code>const fn</code>s in the standard library</h3>
<p>With Rust 1.40.0, the following function became <code>const fn</code>:</p>
<ul>
<li><a href="https://doc.rust-lang.org/std/primitive.u8.html#method.is_power_of_two"><code>is_power_of_two</code></a> for <a href="https://github.com/rust-lang/rust/pull/65092">unsigned integers</a></li>
</ul>
<h3><a href="#additions-to-the-standard-library" aria-hidden="true" class="anchor" id="additions-to-the-standard-library"></a>Additions to the standard library</h3>
<p>In Rust 1.40.0 the following functions and macros were stabilized:</p>
<ul>
<li>
<p><a href="https://doc.rust-lang.org/std/macro.todo.html"><code>todo!()</code></a></p>
<p>A macro, which is a shorter, more memorable, and convenient version of <a href="https://doc.rust-lang.org/std/macro.unimplemented.html"><code>unimplemented!()</code></a>.</p>
</li>
<li>
<p><a href="https://doc.rust-lang.org/std/primitive.slice.html#method.repeat"><code>slice::repeat</code></a></p>
<p>Creates a <code>Vec&lt;T&gt;</code> by repeating a slice <code>n</code> times.</p>
</li>
<li>
<p><a href="https://doc.rust-lang.org/std/mem/fn.take.html"><code>mem::take</code></a></p>
<p>This function <code>take</code>s the value out of a mutable reference and replaces it with the type's default. This is similar to <a href="https://doc.rust-lang.org/std/option/enum.Option.html#method.take"><code>Option::take</code></a> and <a href="https://doc.rust-lang.org/std/cell/struct.Cell.html#method.take"><code>Cell::take</code> </a> and provides a convenient short-hand for <a href="https://doc.rust-lang.org/std/mem/fn.replace.html"><code>mem::replace(&amp;mut dst, Default::default())</code></a>.</p>
</li>
<li>
<p><a href="https://doc.rust-lang.org/std/collections/struct.BTreeMap.html#method.get_key_value"><code>BTreeMap::get_key_value</code></a> and <a href="https://doc.rust-lang.org/std/collections/struct.HashMap.html#method.get_key_value"><code>HashMap::get_key_value</code></a></p>
<p>Returns the key-value pair corresponding to the supplied key.</p>
</li>
<li>
<p><a href="https://doc.rust-lang.org/std/option/enum.Option.html#method.as_deref"><code>Option::as_deref</code></a>, <a href="https://doc.rust-lang.org/std/option/enum.Option.html#method.as_deref_mut"><code>Option::as_deref_mut</code></a></p>
<p>These work similarly to <a href="https://doc.rust-lang.org/std/option/enum.Option.html#method.as_ref"><code>Option::as_ref</code></a> and <a href="https://doc.rust-lang.org/std/option/enum.Option.html#method.as_mut"><code>Option::as_mut</code></a> but also use <a href="https://doc.rust-lang.org/std/ops/trait.Deref.html"><code>Deref</code></a> and <a href="https://doc.rust-lang.org/std/ops/trait.DerefMut.html"><code>DerefMut</code></a> respectively, so that <code>opt_box.as_deref()</code> and <code>opt_box.as_deref_mut()</code>, where <code>opt_box: Option&lt;Box&lt;T&gt;&gt;</code>, produce an <code>Option&lt;&amp;T&gt;</code> and <code>Option&lt;&amp;mut T&gt;</code> respectively.</p>
</li>
<li>
<p><a href="https://doc.rust-lang.org/std/option/enum.Option.html#method.flatten"><code>Option::flatten</code></a></p>
<p>This function flattens an <code>Option&lt;Option&lt;T&gt;&gt;</code> to <code>Option&lt;T&gt;</code> producing <code>Some(x)</code> for <code>Some(Some(x))</code> and <code>None</code> otherwise. The function is similar to <a href="https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.flatten"><code>Iterator::flatten</code></a>.</p>
</li>
<li>
<p><a href="https://doc.rust-lang.org/std/net/struct.UdpSocket.html#method.peer_addr"><code>UdpSocket::peer_addr</code></a></p>
<p>Returns the socket address of the remote peer this socket was connected to.</p>
</li>
<li>
<p><a href="https://doc.rust-lang.org/std/primitive.f32.html#method.to_be_bytes"><code>{f32,f64}::to_be_bytes</code></a>, <a href="https://doc.rust-lang.org/std/primitive.f32.html#method.to_le_bytes"><code>{f32,f64}::to_le_bytes</code></a>,<a href="https://doc.rust-lang.org/std/primitive.f32.html#method.to_ne_bytes"><code>{f32,f64}::to_ne_bytes</code></a>, <a href="https://doc.rust-lang.org/std/primitive.f32.html#method.from_be_bytes"><code>{f32,f64}::from_be_bytes</code></a>, <a href="https://doc.rust-lang.org/std/primitive.f32.html#method.from_le_bytes"><code>{f32,f64}::from_le_bytes</code></a>, and <a href="https://doc.rust-lang.org/std/primitive.f32.html#method.from_ne_bytes"><code>{f32,f64}::from_ne_bytes</code></a></p>
<p>Return the memory representation of the floating point number as a byte array in big-endian (network), little-endian, and native-endian byte order.</p>
</li>
</ul>
<h3><a href="#other-changes" aria-hidden="true" class="anchor" id="other-changes"></a>Other changes</h3>
<p>There are other changes in the Rust 1.40.0 release: check out what changed in <a href="https://github.com/rust-lang/rust/blob/master/RELEASES.md#version-1400-2019-12-19">Rust</a>, <a href="https://github.com/rust-lang/cargo/blob/master/CHANGELOG.md#cargo-140-2019-12-19">Cargo</a>, and <a href="https://github.com/rust-lang/rust-clippy/blob/master/CHANGELOG.md#rust-140">Clippy</a>.</p>
<p>Please also see the <a href="https://github.com/rust-lang/rust/blob/master/RELEASES.md#compatibility-notes">compatibility notes</a> to check if you're affected by those changes.</p>
<h2><a href="#contributors-to-1400" aria-hidden="true" class="anchor" id="contributors-to-1400"></a>Contributors to 1.40.0</h2>
<p>Many people came together to create Rust 1.40.0. We couldn't have done it
without all of you. <a href="https://thanks.rust-lang.org/rust/1.40.0/">Thanks!</a></p>

    </div>
  </div>
</section>

    <footer>
  <div class="w-100 mw-none ph3 mw8-m mw9-l center f3">
    <div class="row">
      <div class="four columns mt3 mt0-l" id="get-help">
        <h4>Get help!</h4>
        <ul>
          <li><a href="https://doc.rust-lang.org" target="_blank" rel="noopener">Documentation</a></li>
          <li><a href="mailto:core-team@rust-lang.org">Contact the Rust Team</a></li>
          <li><a href="http://ping.rust-lang.org">Check Website Status</a></li>
        </ul>
      </div>
      <div class="four columns mt3 mt0-l">
        <h4>Terms and policies</h4>
        <ul>
          <li><a href="https://www.rust-lang.org/policies/code-of-conduct">Code of Conduct</a></li>
          <li><a href="https://www.rust-lang.org/policies/licenses">Licenses</a></li>
          <li><a href="https://www.rust-lang.org/policies/media-guide">Logo Policy and Media Guide</a></li>
          <li><a href="https://www.rust-lang.org/policies/security">Security Disclosures</a></li>
          <li><a href="https://www.rust-lang.org/policies">All Policies</a></li>
        </ul>
      </div>
      <div class="four columns mt3 mt0-l">
        <h4>Social</h4>
        <a href="https://twitter.com/rustlang" target="_blank" rel="noopener" alt="twitter link"><img src="/images/twitter.svg" alt="twitter logo" title="Twitter"/></a>
        <a href="https://www.youtube.com/channel/UCaYhcUwRBNscFNUKTjgPFiA" target="_blank" rel="noopener" alt="youtube link"><img style="padding-top: 6px; padding-bottom:6px" src="/images/youtube.svg" alt="youtube logo" title="YouTube"/></a>
        <a href="https://discord.gg/rust-lang" target="_blank" rel="noopener" alt="discord link"><img src="/images/discord.svg" alt="discord logo" title="Discord"/></a>
        <a href="https://github.com/rust-lang" target="_blank" rel="noopener" alt="github link"><img src="/images/github.svg" alt="github logo" title="GitHub"/></a>
      </div>

    </div>
    <div class="attribution">
      Maintained by the Rust Team. See a typo?
      <a href="https://github.com/rust-lang/blog.rust-lang.org" target="_blank" rel="noopener">Send a fix here</a>!
    </div>
  </div>
</footer>

<!-- scripts -->
<script src="/scripts/highlight.js"></script>

  </body>
</html>
